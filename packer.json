{
	"variables": {
		"docker_username":"",
		"docker_password":""
	},
	
	"builders":[
		{
		"type": "docker",
		"image": "tomcat:9.0",
		"commit": true,
		"changes": [
			"EXPOSE 8080",
			"CMD ["catalina.sh", "run"]" ]
		}
	],

	"provisioners":[
		{
			"type": "ansible-local",
			"playbook_file": "./playbook.yml"
		},
		{
			"type": "file",
			"source": "/build/libs/PetStore.war",
			"destination": "/usr/local/tomcat/webapps/PetStore.war"
		}	
	],
	"post-processors":[
		[
			{
				"type": "docker-tag",
				"repository": "victoremanuelsr/petstore",
				"tag": "petstore"
			},
			{
				"type": "docker-push",
				"login":true,
				"login_username":"{{user `docker_username`}}",
				"login_password":"{{user `docker_password`}}"
			}
		]
	]
}